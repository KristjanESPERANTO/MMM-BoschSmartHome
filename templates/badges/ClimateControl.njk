{% macro render(room, utils) %}
  {% set climateControlService = utils.getClimateControlService(room.devices) %}
  {% set temperatureLevelService = utils.getTemperatureLevelService(room.devices) %}
  {% if climateControlService and temperatureLevelService %}

    {% if climateControlService.state.operationMode == "AUTOMATIC" %}
      {% set icon = '<i class="far fa-clock"></i>' %}
      {% if climateControlService.state.setpointTemperature == climateControlService.state.setpointTemperatureForLevelComfort %}
        {% set operationMode = "bsh-comfort" %}
      {% elif climateControlService.state.setpointTemperature == climateControlService.state.setpointTemperatureForLevelEco %}
        {% set operationMode = "bsh-eco" %}
      {% else %}
        {% set operationMode = "bsh-manual" %}
      {% endif %}
    {% else %}
      {% set icon = '<i class="fas fa-user-cog"></i>' %}
      {% set operationMode = "bsh-manual" %}
    {% endif %}

    <span class="bsh-badge climate-control {{ operationMode }}">
    {{ icon | safe }}
    {% if climateControlService.state.operationMode == "AUTOMATIC" %}
      AUTO
    {% else %}
      MANUAL
    {% endif %}
    </span>
  {% endif %}
{% endmacro %}
